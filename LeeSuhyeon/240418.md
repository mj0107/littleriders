## 240418 
- 오늘 한 일
  - [x] ERD 변수명 수정
  - [x] API 명세서 작성
  - [x] 이메일 검증을 통한 회원 가입 방법 정리

### 이메일 검증을 통한 회원 가입 방법 3가지

#### 1. 인증 후 회원 가입 (send → verify → signup)
1. 유저가 이메일 입력 후 인증 요청
2. 해당 이메일로 이미 가입한 회원이 있는지 확인. 존재한다면 예외 발생
3. 인증 코드 생성 후 Redis에 저장
    1. 이메일을 키로 하고 인증 코드를 값으로 저장
    2. TTL(Time To Live)를 설정하여 일정 시간 후에 자동으로 정보가 삭제되도록 한다
4. 인증 코드를 사용자의 이메일로 발송
5. 인증 코드 검증
    1. 사용자가 입력한 코드와 Redis에 저장된 코드를 비교
    2. 일치하면 이메일 새로운 코드(UUID)를 생성하여 Redis에 저장
    3. UUID를 http response로 프론트에 보내줌
6. 유저가 회원 가입 양식을 작성하고 회원가입 버튼 클릭
    1. Redis에 해당 UUID가 존재하는지 확인
    2. UUID가 존재하다면 회원 가입 절차 완료
7. 사용자 계정 생성 후 MySQL에 저장

**이슈**
- 유저가 정보 입력 후 회원 가입 버튼을 클릭할 때 해당 유저가 이메일 인증 받은 유저와 동일한지 어떻게 확인할까?
    - 인증 코드가 2개 필요하다
        1. 이메일 인증을 위한 인증 코드
            1. 인증 코드 생성 시 Redis에 저장
            2. 유효 시간 짧음
            3. 유효 시간이 지나거나 이메일 인증을 완료하면 Redis에서 삭제
        2. 회원 가입 완료 시 동일 유저인지 확인을 위한 인증 코드 (UUID)
            1. 이메일 인증 완료 시 생성하여 Redis에 저장
            2. 유효 시간 김 (30분 정도) - 세션 만료 시간

- UUID는 JWT로 대체할 수 있지 않을까?
    - 가능하다. 그런데 JWT를 사용하려면 DB도 함께 사용해야 하며 그 이유는 다음과 같다.

**JWT의 특성과 한계**

- **자가 포함성(Self-contained)**: JWT는 인증 정보를 포함하고 있으며, 이는 서버나 데이터베이스의 부가적인 조회 없이도 검증이 가능하다.
- **불변성(Immutability)**: 한 번 생성된 JWT는 수정될 수 없다. 이는 보안을 강화하지만, 토큰의 내용을 동적으로 변경할 필요가 있을 때는 제약이 될 수 있다.

**JWT의 사용 가능 횟수 제한 시나리오**

JWT를 3번만 사용할 수 있다고 가정한다. 클라이언트가 가지고 있는 JWT 내에 `time`이라는 사용 가능 횟수를 포함시키고, 이를 서버 측에서 관리하고자 한다. 이 경우의 주요 이슈는 JWT가 수정될 수 없다는 것이다. 따라서 서버는 사용 가능 횟수가 변경될 때마다 새로운 JWT를 발급해야 한다. 그리고 클라이언트가 올바른(최신) JWT를 사용했는지 서버가 확인해야 한다.

**데이터베이스 사용 필요성**

- **토큰의 상태 추적**: `time`과 같은 동적인 값을 추적하려면, 데이터베이스에 해당 토큰의 상태를 기록하고, 요청이 있을 때마다 이를 확인하고 갱신해야 한다.
- **복수의 토큰 관리**: 클라이언트가 이전의 JWT를 계속 사용할 수도 있으므로, 서버는 발행한 모든 JWT의 상태를 추적하고, 만료되거나 무효화된 토큰을 체크할 수 있어야 한다.
- **보안과 일관성**: 최신 토큰만이 유효하다는 서버의 정책을 강제하기 위해, 각 토큰 발행 시 데이터베이스에 기록하고, 각 요청마다 유효성을 검사한다.

#### 2. 회원 가입 후 이메일 검증 - 30분 동안 유효 (signup → send → verify)

#### 3. 회원 가입 후 로그인 후 이메일 검증 (signup → login → send → verify)

#### 3가지 방법의 비교
1번, 2번 방법은 신원 확인 어렵다.
3번은 JWT가 있으므로 신원 특정 가능하다.